<!DOCTYPE html>
<html>
<head>
  <title>Test Supabase Connection</title>
</head>
<body>
  <h1>Supabase Connection Test</h1>
  <div id="results"></div>
  
  <script type="module">
    const SUPABASE_URL = 'https://bsoqgfryliphvvmqxryu.supabase.co'
    const SUPABASE_KEY = 'sb_publishable_gf8LCC10Qd32Ou9-UTZXrA_r-rF9EoA'
    
    const results = document.getElementById('results')
    
    async function test() {
      results.innerHTML = '<p>Testing connection...</p>'
      
      // Test 1: Check if we can reach Supabase
      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/`, {
          headers: {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`
          }
        })
        results.innerHTML += `<p>✅ Supabase reachable: ${response.status}</p>`
      } catch (e) {
        results.innerHTML += `<p>❌ Cannot reach Supabase: ${e.message}</p>`
      }
      
      // Test 2: Check if push_subscriptions table exists
      try {
        const response = await fetch(`${SUPABASE_URL}/rest/v1/push_subscriptions?select=count`, {
          headers: {
            'apikey': SUPABASE_KEY,
            'Authorization': `Bearer ${SUPABASE_KEY}`,
            'Prefer': 'count=exact'
          }
        })
        if (response.ok) {
          results.innerHTML += `<p>✅ push_subscriptions table exists</p>`
        } else {
          results.innerHTML += `<p>❌ push_subscriptions table not found: ${response.status} ${response.statusText}</p>`
        }
      } catch (e) {
        results.innerHTML += `<p>❌ Error checking table: ${e.message}</p>`
      }
      
      // Test 3: Check Edge Functions
      try {
        const response = await fetch(`${SUPABASE_URL}/functions/v1/upsert_subscription`, {
          method: 'OPTIONS',
          headers: {
            'apikey': SUPABASE_KEY
          }
        })
        if (response.ok || response.status === 405) {
          results.innerHTML += `<p>✅ Edge Functions endpoint reachable</p>`
        } else {
          results.innerHTML += `<p>⚠️ Edge Functions might not be deployed: ${response.status}</p>`
        }
      } catch (e) {
        results.innerHTML += `<p>❌ Error checking Edge Functions: ${e.message}</p>`
      }
    }
    
    test()
  </script>
</body>
</html>

